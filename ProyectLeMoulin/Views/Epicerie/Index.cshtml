@{
    ViewBag.Title = "Home Page";
}

<style>
    .textbox    {   width:58%; height:10%;  }
</style>
@section Scripts {
<script type="text/x-handlebars-template" id="CategoriesTemplate" >
        Catégories<select id="CategoryOutput" name="Categories" class="form-control">
            {{#each}}
                <option id={{CategoryID}}>{{CategoryName}}</option>
            {{/each}}
        </select>
</script>

<script type="text/x-handlebars-template" id="ProductsTemplate" >
    <div class="row">
        <h4 class="col-xs-4">Produits</h4>
        <h4 class="col-xs-3">Format</h4>
        <h4 class="col-xs-2">Prix $</h4>
        <h4 class="col-xs-2">Qty</h4>
        <h4 class="col-xs-1">Ajouter</h4>
    </div>    
    {{#each}}   
    <div class="row" id=Product{{ProductID}}>
        <div class="col-xs-4">
            <h5 id="Name{{ProductID}}" >{{ProductName}}</h5>
        </div>
        <div class="col-xs-3">
            <h5 id="Format{{ProductID}}">{{Format}}</h5>
        </div>
        <div class="col-xs-2">
            <h5 id="Price{{ProductID}}" >{{Price}}</h5>
        </div>
        <div class="col-xs-2">
            <input class="textbox" id="Quantity{{ProductID}}" type="text" value="0" />
        </div>
        <div class="col-xs-1">
            <input id="AddProduct{{ProductID}}" type="submit" value="OK" class="btn btn-success" onclick="AjouterPanier('{{ProductID}}')" />
        </div> 
        </div>  
    {{/each}}      
</script>

<script type="text/x-handlebars-template" id="CartTemplate">
     
    <div id="prod{{id}}"        class="row">
        <div id="pname{{id}}"   class="col-xs-3">{{nom}}</div>
        <div id="pformat{{id}}" class="col-xs-2">{{format}} </div>
        <div id="pprix{{id}}"   class="col-xs-1">{{prix}} $</div>
        <div id="pqty{{id}}"    class="col-xs-1"><input class="textbox" id="CartQuantity{{id}}" type="text" value="{{qty}}" disabled="disabled" /></div>
        <div id="psous{{id}}"   class="col-xs-2">{{Soustotal}} $</div>
        <div class="col-xs-1"><input id="Cartupdate{{id}}"  type="button" value="Modifier"  onclick="ModifierProduit('{{id}}')"     class="btn btn-warning" /></div>
        <div class="col-xs-1"><input id="Cartdelete{{id}}"  type="button" value="Enlever"   onclick="SupprimerProduit('{{id}}')"    class="btn btn-danger" /></div>
    </div>
    
</script>



<script type="text/javascript">

    templateCategories  = null;
    templateProducts    = null;
    templateCart        = null;
    var total = 0;
    
    $(function () {
        templateCategories  = Handlebars.compile($("#CategoriesTemplate").html());
        templateProducts    = Handlebars.compile($("#ProductsTemplate").html());
        templateCart        = Handlebars.compile($("#CartTemplate").html());

        $.getJSON("/Epicerie/GetCategories", null, function (data) {//console.log(data.legth);
            var result = templateCategories(data);
            $("#CategoriesOutput").html(result);

            //Afficher les catégories
            $("#CategoryOutput").change(function () {//doit d'abord changer de cat pour pouvoir afficher la 1 ère cat
                var id = $(this).children(":selected").attr("id");
                $.getJSON("/Epicerie/GetProduits", { cat: id }, function (data) {
                    var result = templateProducts(data);
                    $("#ProductsOutput").html(result);
                });//GetProducts
            })//GetCategories                               
        });
    });

    function AjouterPanier(id) {
        if ($("#Quantity" + id).val() > 0) {
            var p = $("#Price" + id).html();
            var q = $("#Quantity" + id).val();
            var sous = p * q;
            var produit = {
                id: id,
                nom: $("#Name" + id).html(),
                format: $("#Format" + id).html(),
                prix: p,
                qty: q,
                Soustotal : sous
            };

            var result = templateCart(produit);
            $("#CartOutput").append(result);
            Caltotal(produit.Soustotal);
            
            $("#AddProduct" + id).attr("disabled", "disabled");
            $("#AddProduct" + id).attr("class", "btn btn-default");
            $("#AddProduct" + id).val("Ajouté");
            $("#Quantity" + id).attr("disabled", "disabled");
            $("#Panier").attr("hidden", false);
        }
        else
        {
            alert("SVP veuillez indiquer une quantité");
        }
    }

    function Caltotal(stotal) {
        $('.produit').each(function () {
            var prix = $(this).children().eq(3).val();

            console.log(total + " " + stotal);
            total += stotal;
            $("#totalOutput").html(total);
        });
    };
    function SupprimerProduit(id) {
        console.log(("#psous").html);
        total = total - $("#psous" + id).html()
        $("#totalOutput").html(total);
        $("#prod" + id).remove();
        $("#AddProduct" + id).attr("disabled", false);
        $("#AddProduct" + id).attr("class", "btn btn-success");
        $("#AddProduct" + id).val("OK");
        $("#Quantity" + id).attr("disabled", false);
        $("#Quantity" + id).val(0);
        if (total < 1) {
            $("#Panier").attr("hidden", true);
        }
    }

    function ModifierProduit(id) {
        if ($("#Cartupdate" + id).val() == "Modifier") {
            $("#Cartupdate" + id).val("OK");
            $("#Cartupdate" + id).attr("class", "btn btn-success");
            $("#CartQuantity" + id).attr("disabled", false);
        } else {
            if ($("#Cartupdate" + id).val() == "OK") {
                $("#Cartupdate" + id).val("Modifier");
                $("#Cartupdate" + id).attr("class", "btn btn-warning");
                $("#CartQuantity" + id).attr("disabled", true);
            }
        }
    }

    $(function () {
        $("#save").on("click", function () {
            var panier = [];
            var i = 0;

            $('.produit').each(function () {
                i++;
                console.log("PRODUIT : ");
                var id = $(this).attr("id");
                var prix = $(this).children().eq(3).val();
                var qty = $(this).children().eq(4).val();
                console.log("id  : " + id);
                console.log("prix  : " + prix);
                console.log("qty  : " + qty);
                var produit = {
                    id: id,
                    prix: prix,
                    qty: qty,
                };
                panier[i] = panier;
            });
            console.log(produits);
        });
    });
    
</script>

}

    <div class="row">
        <div id="Message"></div>
    </div>
    <div class="row">
        <div id="CategoriesOutput" class="col-md-4">Cat/gories</div>
 
        <div id="ProductsOutput" class="col-md-6"></div>
    </div>
    <hr />
<div class="container" id="Panier" hidden="hidden">
    <div class="row">
        <div id="CartOutput" class="col-md-12">
            <div class="row">
                <h4 class="col-xs-3">Produits</h4>
                <h4 class="col-xs-2">Format</h4>
                <h4 class="col-xs-1">Prix $</h4>
                <h4 class="col-xs-1">Qty</h4>
                <h4 class="col-xs-2">Sous-Total</h4>
                <h4 class="col-xs-1">Modifier</h4>
                <h4 class="col-xs-1">Enlever</h4>
            </div>
        </div>

    </div>
    <div class="row"><div class="col-md-offset-9"><h4><b>total $</b></h4><div id="totalOutput">0</div></div></div>
    <div id="go" class="col-xs-9"><input id="Envoyer" class="btn btn-primary" type="button" value="Envoyer" /></div>
</div>
<div style="height:200px; float:left;"></div>






   